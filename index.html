<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My English Learning Tracker</title>
<meta name="description" content="30-day English learning tracker — add videos, take notes, track progress. LocalStorage, export/import." />
<style>
  :root{
    --bg:#f7fbfc; --card:#ffffff; --muted:#6b7280; --text:#0f172a;
    --accent:#0ea5a4; --accent-dark:#048080; --success:#16a34a; --danger:#ef4444;
    --radius:12px; --gap:14px; --maxw:980px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    margin:0; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;
    padding:22px; display:flex; align-items:flex-start; justify-content:center;
  }

  .wrap{width:100%; max-width:var(--maxw);}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
  header h1{margin:0;font-size:20px}
  header .sub{color:var(--muted);font-size:13px}

  .grid{display:grid;grid-template-columns:320px 1fr;gap:var(--gap)}
  @media(max-width:880px){ .grid{grid-template-columns:1fr} }

  .card{background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
  .side .compact{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:12px}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  select,input[type="text"],input[type="url"],textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef6;font-size:14px}
  textarea{min-height:160px;resize:vertical}
  .btn{display:inline-block;padding:9px 12px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer}
  .btn.ghost{background:#eef8f7;color:var(--accent-dark);font-weight:600}
  .btn.warn{background:var(--success)}
  .btn.danger{background:var(--danger)}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px}
  .row{display:flex;gap:10px;align-items:center}
  .links{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .link-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #eef2f7;background:#fbfdff}
  .progress{height:12px;background:#eef2f7;border-radius:999px;overflow:hidden;margin-top:8px}
  .progress > div{height:100%;background:linear-gradient(90deg,var(--accent),#0ea5a0);width:0%}
  footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}

  .player{width:100%;aspect-ratio:16/9;background:#000;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center}
  .player iframe{width:100%;height:100%;border:0}
  .meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:space-between}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .kbd{background:#f1f5f9;padding:4px 8px;border-radius:6px;font-size:13px;color:#0f172a}
  .center{display:flex;align-items:center;gap:8px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>My English Learning Tracker</h1>
        <div class="sub">Clear, focused workspace — add videos, write notes, track progress</div>
      </div>
      <div class="center">
        <div class="muted" id="todayDate"></div>
        <button class="btn ghost" id="exportBtn" title="Export your plan (JSON)">Export</button>
        <label class="btn ghost" style="cursor:pointer">
          Import
          <input id="importFile" type="file" accept="application/json" style="display:none">
        </label>
      </div>
    </header>

    <main class="grid">
      <!-- Sidebar -->
      <aside class="side card">
        <div class="compact">
          <div>
            <label for="daySelect">Choose Day</label>
            <select id="daySelect" aria-label="Select day"></select>
            <div class="muted small" id="dayHint" style="margin-top:6px">Day progress and quick actions</div>
          </div>
          <div style="text-align:right">
            <div class="muted small">Completed</div>
            <div id="dayCompleteBadge" style="font-weight:700;margin-top:6px">—</div>
          </div>
        </div>

        <div style="margin-top:10px">
          <label>Overall Progress</label>
          <div class="progress"><div id="progressBar" style="width:0%"></div></div>
          <div style="display:flex;justify-content:space-between;margin-top:8px">
            <div class="muted small">Completed <strong id="completedCount">0</strong>/30</div>
            <div class="muted small" id="progressPct">0%</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <label>Quick actions</label>
          <div class="row" style="margin-top:6px">
            <button class="btn ghost" id="prevDay">Prev</button>
            <button class="btn ghost" id="nextDay">Next</button>
            <button class="btn" id="markComplete">Mark Complete</button>
          </div>
        </div>

        <div style="margin-top:14px">
          <label>Saved links (this day)</label>
          <div id="linkCount" class="muted small">0 links</div>
          <div id="linksPreview" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn ghost" id="resetBtn">Reset Local</button>
          <button class="btn ghost" id="clearLinks">Clear Links</button>
        </div>

        <div style="margin-top:14px" class="muted small">
          Tip: Paste a YouTube URL in the "Video URL" field and press Enter or Add to set the embedded player.
        </div>
      </aside>

      <!-- Main workspace -->
      <section class="card">
        <div class="meta" style="margin-bottom:10px">
          <div style="flex:1 1 60%">
            <label for="videoUrl">Video URL</label>
            <input id="videoUrl" type="url" placeholder="Paste YouTube link (e.g. https://youtu.be/ID or https://www.youtube.com/watch?v=ID)" />
          </div>
          <div style="width:220px">
            <label for="linkTitle">Short title (optional)</label>
            <input id="linkTitle" type="text" placeholder="e.g., Vanessa — Introductions" />
          </div>
        </div>

        <div class="player card" id="playerWrap" style="margin-bottom:12px">
          <!-- iframe inserted dynamically -->
          <div id="playerFallback" class="muted">No video loaded — paste a YouTube link above and press Add or Enter.</div>
        </div>

        <div style="display:flex;gap:14px;margin-bottom:12px;align-items:center">
          <div style="flex:1">
            <label>Notes / Practice (autosaved)</label>
            <textarea id="notes" placeholder="Write practice sentences, vocabulary, or self-feedback here..."></textarea>
          </div>

          <div style="width:220px">
            <label>Session actions</label>
            <div style="display:flex;flex-direction:column;gap:8px">
              <button class="btn" id="addLinkBtn">Add to Day</button>
              <button class="btn ghost" id="openInNew">Open Video</button>
              <button class="btn ghost" id="playTTS">Read Notes</button>
              <button class="btn danger" id="deleteDayBtn">Delete Day Data</button>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px">
          <div style="display:flex;gap:8px;align-items:center">
            <span class="muted">Saved links for current day:</span>
            <strong id="currentLinksCount">0</strong>
          </div>
          <div class="muted small">Keyboard: <span class="kbd">Ctrl/Cmd + S</span> saves manually</div>
        </div>

        <div id="linksList" class="links" aria-live="polite"></div>
      </section>
    </main>

    <footer>
      <div class="muted">This app stores your data locally (browser). Export JSON to back up or move to another device.</div>
    </footer>
  </div>

<script>
/* Professional single-file learning tracker
   - 30 days, localStorage persistence
   - add YouTube links, embedded player
   - notes autosave, mark complete
   - export/import JSON
*/
const STORAGE_KEY = 'my_english_tracker_v2';
const DAYS = 30;
const todayDateEl = document.getElementById('todayDate');
todayDateEl.textContent = new Date().toLocaleDateString(undefined, { weekday:'short', year:'numeric', month:'short', day:'numeric' });

/* default starter content for first 7 days (learner-focused) */
const starter = {
  1: { title: "Greetings & Intro", notes:"Practice: Hello. My name is ... I am from ...", links:[
    {title:"VOA: Meeting People", url:"https://www.youtube.com/watch?v=7usN8qGizEw"}
  ]},
  2: { title: "Where Are You From?", notes:"Practice: I live in ... I like ...", links:[
    {title:"Vanessa: How to Start a Conversation", url:"https://www.youtube.com/watch?v=2Sfp4D9mH6Q"}
  ]},
  3: { title: "Objects & Everyday Words", notes:"Name 10 things in your room.", links:[
    {title:"VOA: What is This?", url:"https://www.youtube.com/watch?v=fs5BBpfG6a0"}
  ]},
  4: { title: "Jobs & Work", notes:"Practice: I work as a ...", links:[
    {title:"Vanessa: Talking About Your Job", url:"https://www.youtube.com/watch?v=1HjYGVYCM9g"}
  ]},
  5: { title: "Daily Routines", notes:"Describe your morning routine.", links:[
    {title:"VOA: Everyday Activities", url:"https://www.youtube.com/watch?v=14bUJmg84us"}
  ]},
  6: { title: "Numbers & Age", notes:"Practice numbers and age questions.", links:[
    {title:"VOA: How Old Are You?", url:"https://www.youtube.com/watch?v=Sdq_rOXUwcY"}
  ]},
  7: { title: "Review Day", notes:"Speak for 2 minutes about yourself.", links:[]}
};

/* DOM */
const daySelect = document.getElementById('daySelect');
const dayCompleteBadge = document.getElementById('dayCompleteBadge');
const progressBar = document.getElementById('progressBar');
const progressPct = document.getElementById('progressPct');
const completedCount = document.getElementById('completedCount');
const videoUrl = document.getElementById('videoUrl');
const linkTitle = document.getElementById('linkTitle');
const addLinkBtn = document.getElementById('addLinkBtn');
const linksList = document.getElementById('linksList');
const linksPreview = document.getElementById('linksPreview');
const linkCount = document.getElementById('linkCount');
const notes = document.getElementById('notes');
const playerWrap = document.getElementById('playerWrap');
const playerFallback = document.getElementById('playerFallback');

const prevDay = document.getElementById('prevDay');
const nextDay = document.getElementById('nextDay');
const markComplete = document.getElementById('markComplete');
const clearLinks = document.getElementById('clearLinks');
const resetBtn = document.getElementById('resetBtn');
const deleteDayBtn = document.getElementById('deleteDayBtn');
const openInNew = document.getElementById('openInNew');
const playTTS = document.getElementById('playTTS');

const exportBtn = document.getElementById('exportBtn');
const importFile = document.getElementById('importFile');

let state = loadState();
let current = 1; // selected day

/* initialize days select */
function initDaySelect(){
  daySelect.innerHTML = '';
  for(let i=1;i<=DAYS;i++){
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = `Day ${i}${state[i] && state[i].title ? ' — '+state[i].title : ''}`;
    daySelect.appendChild(opt);
  }
  daySelect.value = current;
}

/* load & save */
function buildEmpty(){
  const obj = {};
  for(let i=1;i<=DAYS;i++){
    obj[i] = { title: `Day ${i}`, notes:'', links:[], completed:false };
    if(starter[i]){
      obj[i].title = starter[i].title;
      obj[i].notes = starter[i].notes || '';
      obj[i].links = starter[i].links ? JSON.parse(JSON.stringify(starter[i].links)) : [];
    }
  }
  return obj;
}
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) {
      const base = buildEmpty();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(base));
      return base;
    }
    const parsed = JSON.parse(raw);
    // ensure shape
    for(let i=1;i<=DAYS;i++) if(!parsed[i]) parsed[i] = { title:`Day ${i}`, notes:'', links:[], completed:false };
    return parsed;
  }catch(e){
    console.error('load error', e);
    const base = buildEmpty();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(base));
    return base;
  }
}
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* UI render */
function render(){
  initDaySelect();
  const s = state[current];
  daySelect.value = current;
  dayCompleteBadge.textContent = s.completed ? 'Yes' : 'No';
  markComplete.textContent = s.completed ? 'Mark Incomplete' : 'Mark Complete';
  notes.value = s.notes || '';
  renderLinks();
  renderPreview();
  renderProgress();
  // player
  const firstUrl = s.links && s.links.length ? s.links[0].url : '';
  if(firstUrl){
    setPlayer(firstUrl);
  } else {
    setPlayer(null);
  }
}
function renderLinks(){
  const s = state[current];
  linksList.innerHTML = '';
  if(!s.links || s.links.length === 0){
    linksList.innerHTML = '<div class="muted">No links saved for this day.</div>';
  } else {
    s.links.forEach((l, idx) => {
      const div = document.createElement('div');
      div.className = 'link-item';
      div.innerHTML = `<div style="max-width:70%">
        <div style="font-weight:600">${escapeHtml(l.title || l.url)}</div>
        <div class="muted small">${escapeHtml(l.url)}</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn ghost" data-action="open" data-idx="${idx}">Open</button>
        <button class="btn ghost" data-action="use" data-idx="${idx}">Use</button>
        <button class="btn danger" data-action="remove" data-idx="${idx}">Remove</button>
      </div>`;
      linksList.appendChild(div);
    });
  }
  document.querySelectorAll('[data-action]').forEach(btn=>{
    btn.onclick = (e)=>{
      const action = btn.getAttribute('data-action'), idx = Number(btn.getAttribute('data-idx'));
      if(action==='open'){ window.open(state[current].links[idx].url, '_blank'); }
      if(action==='use'){ videoUrl.value = state[current].links[idx].url; setPlayer(videoUrl.value); }
      if(action==='remove'){ if(confirm('Remove this link?')){ state[current].links.splice(idx,1); saveState(); render(); } }
    };
  });
  document.getElementById('currentLinksCount').textContent = state[current].links.length;
}

function renderPreview(){
  const s = state[current];
  linksPreview.innerHTML = '';
  if(!s.links || s.links.length===0) linksPreview.innerHTML = '<div class="muted small">None</div>';
  else{
    const list = document.createElement('div');
    list.style.display = 'flex';
    list.style.flexDirection = 'column';
    list.style.gap = '6px';
    s.links.slice(0,3).forEach(l=>{
      const el = document.createElement('div'); el.className='muted small'; el.textContent = l.title || l.url; list.appendChild(el);
    });
    linksPreview.appendChild(list);
  }
  linkCount.textContent = state[current].links.length + ' links';
}

function renderProgress(){
  const done = Object.values(state).filter(x=>x.completed).length;
  const pct = Math.round((done / DAYS) * 100);
  progressBar.style.width = pct + '%';
  progressPct.textContent = pct + '%';
  completedCount.textContent = done;
}

/* helpers */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* video handling - extract YouTube ID and set iframe */
function extractYouTubeId(url){
  try{
    if(!url) return null;
    // common forms:
    // https://www.youtube.com/watch?v=ID
    // https://youtu.be/ID
    // https://www.youtube.com/embed/ID
    const u = new URL(url);
    if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
    if(u.hostname.includes('youtube.com')){
      if(u.searchParams && u.searchParams.get('v')) return u.searchParams.get('v');
      const parts = u.pathname.split('/');
      return parts[parts.length-1] || null;
    }
    return null;
  }catch(e){ return null; }
}
function setPlayer(url){
  const id = extractYouTubeId(url || '');
  playerWrap.innerHTML = '';
  if(!id){
    playerWrap.appendChild(playerFallback);
    playerFallback.style.display = 'block';
    return;
  }
  const iframe = document.createElement('iframe');
  iframe.src = `https://www.youtube.com/embed/${id}?rel=0`;
  iframe.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture';
  iframe.setAttribute('allowfullscreen','');
  playerWrap.appendChild(iframe);
}

/* events */
daySelect.addEventListener('change', (e)=> { current = Number(e.target.value); render(); });
prevDay.addEventListener('click', ()=> { if(current>1) current--; render(); });
nextDay.addEventListener('click', ()=> { if(current<DAYS) current++; render(); });

addLinkBtn.addEventListener('click', ()=>{
  const url = videoUrl.value.trim();
  if(!url){ alert('Paste a YouTube URL first.'); videoUrl.focus(); return; }
  const id = extractYouTubeId(url);
  if(!id){ alert('Invalid YouTube URL.'); return; }
  const title = linkTitle.value.trim() || `Video ${state[current].links.length+1}`;
  state[current].links.push({ title, url });
  saveState(); render();
  videoUrl.value = '';
  linkTitle.value = '';
});

markComplete.addEventListener('click', ()=>{
  state[current].completed = !state[current].completed;
  saveState(); render();
});

clearLinks.addEventListener('click', ()=>{
  if(confirm('Clear all links for this day?')){ state[current].links = []; saveState(); render(); }
});

resetBtn.addEventListener('click', ()=>{
  if(confirm('Reset all local progress and restore starter content?')) {
    localStorage.removeItem(STORAGE_KEY);
    state = loadState(); current = 1; render();
  }
});

deleteDayBtn.addEventListener('click', ()=>{
  if(confirm('Delete all data for this day?')) {
    state[current] = { title:`Day ${current}`, notes:'', links:[], completed:false };
    saveState(); render();
  }
});

openInNew.addEventListener('click', ()=>{
  const url = videoUrl.value.trim() || (state[current].links[0] && state[current].links[0].url);
  if(!url) return alert('No video URL available.');
  window.open(url, '_blank');
});

playTTS.addEventListener('click', ()=>{
  const text = notes.value.trim() || 'No notes to read.';
  const u = new SpeechSynthesisUtterance(text);
  window.speechSynthesis.speak(u);
});

/* notes autosave */
notes.addEventListener('input', ()=>{
  state[current].notes = notes.value;
  saveState();
});

/* videoUrl enter to set player quickly */
videoUrl.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){ e.preventDefault(); const url = videoUrl.value.trim(); if(!url) return; setPlayer(url); }
});

/* keyboard save (Ctrl/Cmd + S) */
window.addEventListener('keydown', (e)=>{
  if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){
    e.preventDefault();
    saveState();
    alert('Saved');
  }
});

/* export/import */
exportBtn.addEventListener('click', ()=>{
  const dataStr = JSON.stringify(state, null, 2);
  const blob = new Blob([dataStr], { type:'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'english_tracker_backup.json'; a.click();
  URL.revokeObjectURL(url);
});
importFile.addEventListener('change', (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = (ev)=>{
    try{
      const parsed = JSON.parse(ev.target.result);
      // basic validation
      if(typeof parsed !== 'object'){ alert('Invalid file.'); return; }
      // merge keys safely
      for(let i=1;i<=DAYS;i++){
        if(parsed[i]) state[i] = parsed[i];
      }
      saveState(); render(); alert('Import complete.');
    }catch(err){ alert('Could not parse JSON.'); }
  };
  r.readAsText(f);
});

/* persist on visibility change */
window.addEventListener('visibilitychange', ()=>{ if(document.hidden) saveState(); });

/* initial render */
initDaySelect();
render();

/* small autosave interval */
setInterval(()=> saveState(), 8000);

</script>
</body>
</html>
